<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หน้าคอร์สวิดีโอ Open-Learning</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="fontawesome/css/all.min.css">
    <link rel="stylesheet" href="css/templatemo-style.css">
<!--
    
TemplateMo 556 Catalog-Z

https://templatemo.com/tm-556-catalog-z

-->
</head>
<body>
    <!-- Page Loader -->
    <!-- <div id="loader-wrapper">
        <div id="loader"></div>

        <div class="loader-section section-left"></div>
        <div class="loader-section section-right"></div>

    </div> -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="home.html">
                <i class="fas fa-book-reader ml-3"></i>
                Open<span style="color:black">-</span>L<span style="color:black">earning</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ml-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link nav-link-1" href="home.html">คอร์สเรียนทั้งหมด</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-2" href="about.html">เกี่ยวกับ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-3"  href="contact.html">ติดต่อ</a>
                    </li>
                    <li class="nav-item">
                        <img src="css/img/img_avatar.png" class="avatar" onclick="toggleMenu()" style="cursor: pointer;">
                        <label class="mt-sm-2" id="email" onclick="toggleMenu()" style="cursor: pointer;"></label>
                        <i class="fas fa-caret-down ml-2" onclick="toggleMenu()" style="cursor: pointer;"></i>
                            <div class="sub-menu-wrap" id="subMenu">
                                <div class="sub-menu">
                                    <div class="user-info">
                                        <img src="css/img/img_avatar.png">
                                        <label id="email2"></label>
                                        
                                    </div>
                                    <hr>
                                    <a class="sub-menu-link" href="user_profile.html">
                                        <i class="fas fa-user icon"></i> 
                                        <p>บัญชีผู้ใช้</p>
                                        
                                    </a>
                                    <a class="sub-menu-link" href="user_course.html">
                                        <i class="fas fa-book icon"></i> 
                                        <p>คอร์สเรียน</p>
                                        
                                    </a>
                                    <a class="sub-menu-link" href="user_payment.html">
                                        <i class="fas fa-wallet icon"></i> 
                                        <p>ประวัติชำระเงิน</p>
                                        
                                    </a>
                                    <a class="sub-menu-link" onclick="logoutUser()">
                                        <i class="fas fa-sign-out-alt icon"></i> 
                                        <p>ออกจากระบบ</p>
                                        
                                    </a>
                                </div>
                            </div>
                        </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="tm-hero d-flex justify-content-center align-items-center" data-parallax="scroll" data-image-src="css/img/hero.jpg">
        <!-- <form class="d-flex tm-search-form">
            <input class="form-control tm-search-input" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success tm-search-btn" type="submit">
                <i class="fas fa-search"></i>
            </button>
        </form> -->
    </div>

    <div id="videoCourse" class="container-fluid tm-container-content tm-mt-60">
        <!-- <div class="row mb-4">
            <h2 class="col-12 tm-text-primary">ตอนเช้า</h2>
        </div>
        <div class="row tm-mb-90">            
            <div class="col-xl-8 col-lg-7 col-md-6 col-sm-12">
                <video autoplay muted loop controls id="tm-video" controls controlsList="nodownload">
                    <source src="" type="video/mp4">
                </video>  
            </div> -->
                <!-- <div id="tm-video">
                    <script>
                        const video = document.createElement('video');
                        video.src =
                        'video/hero.mp4';
                        video.controls = true;
                        video.controlsList = 'nodownload';
                        video.muted = false;
                        video.height = 573; // in px
                        video.width = 1150; // in px
                        const box = document.getElementById('tm-video');
                        box.appendChild(video);
                    </script>
                </div> -->
            <!-- <div class="col-xl-4 col-lg-5 col-md-6 col-sm-12">
                <div class="tm-bg-gray tm-video-details">
                    Maecenas non enim a nisi elementum fringilla in non ante. Phasellus malesuada vitae lectus
                    </p>
                    Quisque tellus tortor, tincidunt eu tincidunt in, ornare id tellus. Quisque erat lacus, faucibus quis dignissim ut, ornare at diam. Curabitur pretium, sapien et euismod accumsan, ipsum est venenatis metus, eget scelerisque ante dolor sed tortor. Cras tincidunt, tellus vitae interdum aliquam, tortor elit fringilla nisl, sit amet pretium ex tellus ut eros. Suspendisse elementum lacinia mi ac tincidunt. Morbi mollis ante vitae felis fringilla, eget posuere ante consequat. Phasellus volutpat dolor ut lorem eleifend, vitae lobortis tellus vulputate.<
                    <div class="text-center">
                        <a href="choice1.html" class="btn btn-primary tm-btn-big mt-3">ทำแบบทดสอบ</a>
                        <a href="QRpay.html" class="btn btn-primary tm-btn-big mt-3 mb-3">ชำระเงิน</a>
                    </div>
                    <div class="mb-4 d-flex flex-wrap">
                        <div class="mr-4 mb-2">
                            <span class="tm-text-gray-dark">ความละเอียด: </span><span class="tm-text-primary">1920x1080</span>
                        </div>
                        <div class="mr-4 mb-2">
                            <span class="tm-text-gray-dark">รูปแบบไฟล์: </span><span class="tm-text-primary">MP4</span>
                        </div>
                        <div>
                            <span class="tm-text-gray-dark">ระยะเวลา: </span><span class="tm-text-primary">00:00:20</span>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
       <!-- <div class="row mb-4">
            <h2 class="col-12 tm-text-primary">
                วิดีโอที่เกี่ยวข้อง
            </h2>
        </div>
        <div class="row mb-3 tm-gallery">
            <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 col-12 mb-5">
                <figure class="effect-ming tm-video-item">
                    <img src="css/img/img-01.jpg" alt="Image" class="img-fluid">
                    <figcaption class="d-flex align-items-center justify-content-center">
                        <h2>Hangers</h2>
                        <a href="#">View more</a>
                    </figcaption>
                </figure>
                <div class="d-flex justify-content-between tm-text-gray">
                    <span class="tm-text-gray-light">12 ตุลาคม 2563</span>
                    <span>12,460 views</span>
                </div>
            </div>
        </div> row -->
    </div>
    <!-- container-fluid, tm-container-content -->
    <footer class="tm-bg-gray pt-5 pb-3 tm-text-gray tm-footer">
        <div class="container-fluid tm-container-small">
            <div class="row">
                <div class="col-lg-6 col-md-12 col-12 px-5 mb-5">
                    <h3 class="tm-text-primary mb-4 tm-footer-title">เกี่ยวกับ Open-Learning</h3>
                    เว็บไซต์สำหรับให้ผู้ใช้ที่ต้องการเรียนออนไลน์เพิ่ม ได้ทำการหาความรู้เพิ่มเติมนอกช่วงเวลาเรียน และทำการเรียนรู้เนื้อหาที่ผู้ใช้สนใจผ่านทางวิดีโอพร้อมกับฝึกทำแบบทดสอบหลังเรียนเพื่อทดสอบความรู้ที่ได้ทำการเรียนไปเรียบร้อยแล้ว
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
                    <h3 class="tm-text-primary mb-4 tm-footer-title">Our Links</h3>
                    <ul class="tm-footer-links pl-0">
                        <li><a href="#">บริษัท</a></li>
                        <li><a href="#">การติดต่อ</a></li>
                    </ul>
                </div>
                <div class="col-lg-3 col-md-6 col-sm-6 col-12 px-5 mb-5">
                    <ul class="tm-social-links d-flex justify-content-end pl-0 mb-5">
                        <li class="mb-2"><a href="https://facebook.com"><i class="fab fa-facebook"></i></a></li>
                        <!-- <li class="mb-2"><a href="https://twitter.com"><i class="fab fa-twitter"></i></a></li> -->
                        <li class="mb-2"><a href="https://linkedin.com"><i class="fab fa-linkedin"></i></a></li>
                    </ul>
                    <a href="#" class="tm-text-gray text-right d-block mb-2">Terms of Use</a>
                    <a href="#" class="tm-text-gray text-right d-block">Privacy Policy</a>
                </div>
            </div>
            <div class="row">
                <div class="col-lg-8 col-md-7 col-12 px-5 mb-3">
                    Copyright 2020 Open-Learning Company. All rights reserved.
                </div>
                <div class="col-lg-4 col-md-5 col-12 px-5 text-right">
                    Designed by <a class="tm-text-gray" rel="sponsored" target="_parent">Template</a>
                </div>
            </div>
        </div>
    </footer>
    <script src="js/plugins.js"></script>

    <script>
    
    async function logoutUser() {
		localStorage.removeItem("userEmail");
		window.location.assign("/index.html");
	}

    const subMenu = document.getElementById("subMenu");
        async function toggleMenu () {
            subMenu.classList.toggle("open-menu");
        }

    const UserEmail = localStorage.getItem("userEmail");
    const jsondata = JSON.stringify({user_email: UserEmail});

    async function getUser () {
        const response = await fetch("http://127.0.0.1:8000/userData/",{
        
        method: 'POST',
        headers: {
        'Content-Type': 'application/json',
        'accept': 'application/json',  
    },
        body: jsondata
    })

        const user = await response.json()
        console.log(user)
        const email = document.getElementById('email');
        email.innerText = user.data.email
        const email2 = document.getElementById('email2');
        email2.innerText = user.data.email
    }
    getUser()

    async function getVideo() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get('id');
        const response = await fetch("http://127.0.0.1:8000/ShowCourseVideo/" + id, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'accept': 'application/json',
            },
        })
        const response_checkcourse = await fetch("http://127.0.0.1:8000/whopaythiscourse/" + id, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'accept': 'application/json',
            },
        })
        const response_checkquiz = await fetch("http://127.0.0.1:8000/CourseHaveQuiz/" + id, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'accept': 'application/json',
            },
        })
        let src = ""
        console.log(id)
        const json = await response.json()
        const checkcourse = await response_checkcourse.json()
        const checkquiz = await response_checkquiz.json()
        checkcourse.c_open.forEach( data => {
            if(data.user_email == localStorage.getItem("userEmail")){
                src = json.data['course_video']
            }

        });
        const videolist = document.getElementById('videoCourse');
        var data = json.data;
        var datalenght = Object.keys(data).length;
        console.log(datalenght)
        const box = document.createElement('div');
         box.innerHTML =    `<div class="row mb-4">
                                <h2 class="col-12 tm-text-primary">${json.data['course_name']}</h2>
                            </div>
                            <div class="row tm-mb-90">            
                                <div class="col-xl-8 col-lg-7 col-md-6 col-sm-12">
                                    <video id="tm-video" controls controlsList="nodownload" preload="none">
                                        <source src="${src}" type="video/mp4">
                                    </video>  
                                </div>
                                <div class="col-xl-4 col-lg-5 col-md-6 col-sm-12">
                                    <div class="h5 tm-bg-gray tm-video-details">
                                        <div>${json.data['course_descript']}</div>
                                        <div class="d-flex button-video-page">
                                            <a href=${"choice1.html?course_id="+json.data['course_id']} class="btn btn-primary tm-btn-big-test mt-3">ทำแบบทดสอบ</a>
                                            <a href=${"QRpay.html?course_id="+json.data['course_id']} class="btn btn-primary tm-btn-big-pay mt-3 mb-3">ชำระเงิน</a>
                                        </div>
                                    </div>
                                </div>
                            </div>`

            const testbutton = box.getElementsByTagName("a")[0]
            const paybutton = box.getElementsByTagName("a")[1]

            checkcourse.c_open.forEach( data => {
            if(data.user_email == localStorage.getItem("userEmail")){
                paybutton.classList.add("d-none")
            }});

            if(checkquiz.have_quiz == "false"){
                console.log("test");
                testbutton.classList.add("d-none")
            }


            box.classList.add('box')
            videolist.appendChild(box)
            // <input class="col-sm-3 checkon_off" type="checkbox" checked data-toggle="toggle" data-style="android" data-onstyle="info"> //
            console.log(data)
            $(window).trigger('resize');
        }
            

        getVideo()


        // noContext = document.getElementById('tm-video');

        // noContext.addEventListener('contextmenu', e => {
        // e.preventDefault();
        // });
        // $(window).on("load", function() {
        //     $('body').addClass('loaded');
        // });


    </script>
</body>
</html>